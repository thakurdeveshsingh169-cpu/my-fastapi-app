<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>BMI + DESH-AI</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --bg:#ffe6f0;
  --card:#ffffff;
  --text:#000;
  --accent:#ff8fb1;
}

body{
  margin:0;
  font-family:Poppins, sans-serif;
  background:var(--bg);
  color:var(--text);
}

/* Card */
.card{
  max-width:360px;
  margin:40px auto;
  background:var(--card);
  padding:25px;
  border-radius:22px;
  box-shadow:0 10px 30px rgba(0,0,0,.2);
  text-align:center;
}

h2{color:var(--accent);}

select,input[type=date]{
  width:100%;
  padding:12px;
  margin:10px 0;
  border-radius:14px;
  border:1px solid #ccc;
  font-size:15px;
}

button{
  width:100%;
  padding:14px;
  margin-top:15px;
  border-radius:18px;
  border:none;
  background:var(--accent);
  color:white;
  font-size:16px;
  cursor:pointer;
}

.result{
  margin-top:15px;
  font-weight:bold;
}

/* ðŸ”¥ DESH-AI LOGO */
#aiBtn{
  position:fixed;
  right:20px;
  bottom:20px;
  width:64px;
  height:64px;
  border-radius:20px;
  display:none;
  cursor:grab;
  box-shadow:0 0 20px rgba(255,0,200,.6);
  animation:pulse 2s infinite;
  user-select:none;
  touch-action:none;
}

@keyframes pulse{
  0%{transform:scale(1)}
  50%{transform:scale(1.08)}
  100%{transform:scale(1)}
}

/* AI Chat */
#aiChat{
  max-width:360px;
  margin:20px auto;
  background:var(--card);
  padding:20px;
  border-radius:18px;
  box-shadow:0 10px 25px rgba(0,0,0,.2);
  display:none;
  line-height:1.6;
}
</style>
</head>

<body>

<div class="card">
  <h2>BMI Calculator</h2>

  <input type="date" id="dob">
  <select id="height"></select>
  <select id="weight"></select>

  <button onclick="calculateBMI()">Calculate BMI</button>
  <div class="result" id="result"></div>
</div>

<div id="aiChat"></div>

<!-- ðŸ”¥ DESH-AI LOGO (PNG / Transparent) -->
<img id="aiBtn" src="/static/logo.png" alt="DESH-AI">

<script>
const heightEl = document.getElementById("height");
const weightEl = document.getElementById("weight");
const dobEl = document.getElementById("dob");
const resultEl = document.getElementById("result");
const aiBtn = document.getElementById("aiBtn");
const aiChat = document.getElementById("aiChat");

/* Populate height & weight */
for(let i=1;i<=250;i++){
  heightEl.innerHTML += `<option ${i===170?"selected":""}>${i}</option>`;
}
for(let i=1;i<=500;i++){
  weightEl.innerHTML += `<option ${i===60?"selected":""}>${i}</option>`;
}

let bmiValue = 0;

/* Calculate BMI */
function calculateBMI(){
  const h = heightEl.value / 100;
  const w = weightEl.value;
  bmiValue = (w / (h*h)).toFixed(1);

  let status =
    bmiValue < 18.5 ? "Underweight ðŸ¥º" :
    bmiValue < 25 ? "Normal ðŸ˜Š" :
    bmiValue < 30 ? "Overweight ðŸ˜…" :
                    "Obese ðŸ˜Ÿ";

  resultEl.innerText = `BMI: ${bmiValue} (${status})`;
  aiBtn.style.display = "block";
}

/* Markdown â†’ HTML */
function mdToHtml(md){
  return md
    .replace(/\*\*(.*?)\*\*/g,"<b>$1</b>")
    .replace(/\n/g,"<br>");
}

/* DESH-AI CALL */
aiBtn.onclick = async () => {
  aiChat.style.display = "block";

  let dots = 0;
  const thinking = setInterval(()=>{
    dots = (dots+1)%4;
    aiChat.innerText = "DESH-AI is thinking" + ".".repeat(dots);
  },500);

  const prompt = `
My BMI is ${bmiValue}
Height: ${heightEl.value} cm
Weight: ${weightEl.value} kg
DOB: ${dobEl.value}

Give response in points.
`;

  try{
    const res = await fetch("https://desh-ai.onrender.com/ask",{
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify({ question: prompt })
    });

    const data = await res.json();
    clearInterval(thinking);
    aiChat.innerHTML = mdToHtml(data.answer || "No response");

  }catch{
    clearInterval(thinking);
    aiChat.innerText = "âš ï¸ DESH-AI server waking up, try again";
  }
};

/* ðŸ”¥ DRAG LOGO (Mobile + Laptop) */
let dragging = false;
let offsetX = 0;
let offsetY = 0;

aiBtn.addEventListener("mousedown", e=>{
  dragging = true;
  aiBtn.style.cursor = "grabbing";
  offsetX = e.clientX - aiBtn.offsetLeft;
  offsetY = e.clientY - aiBtn.offsetTop;
});

document.addEventListener("mousemove", e=>{
  if(!dragging) return;
  move(e.clientX, e.clientY);
});

document.addEventListener("mouseup", ()=>{
  dragging = false;
  aiBtn.style.cursor = "grab";
});

aiBtn.addEventListener("touchstart", e=>{
  dragging = true;
  const t = e.touches[0];
  offsetX = t.clientX - aiBtn.offsetLeft;
  offsetY = t.clientY - aiBtn.offsetTop;
});

document.addEventListener("touchmove", e=>{
  if(!dragging) return;
  const t = e.touches[0];
  move(t.clientX, t.clientY);
});

document.addEventListener("touchend", ()=> dragging=false);

function move(x,y){
  aiBtn.style.left = (x - offsetX) + "px";
  aiBtn.style.top  = (y - offsetY) + "px";
  aiBtn.style.right = "auto";
  aiBtn.style.bottom = "auto";
}
</script>

</body>

</html>
