<!DOCTYPE html>

<html lang="en">

<head>

  <meta charset="UTF-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>ùïØùñäùïæùñç ùóîùó∂ - Neural Supreme</title>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>

    :root {

      --bg-white: #ffffff;

      --ai-bubble: #f1f3f4;

      --user-purple: #7b42f5;

      --text-main: #1a1a1a;

      --border: #e0e0e0;

      --success-green: #28a745;

      --speaking-red: #ef4444;

    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    body {

      margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;

      background-color: var(--bg-white); height: 100vh; display: flex; flex-direction: column; overflow: hidden;

    }

    .header { padding: 12px 20px; border-bottom: 1px solid var(--border); background: #fff; text-align: center; }

    .logo-text { font-size: 22px; font-weight: 800; margin: 0; background: linear-gradient(90deg, #5742f5, #ff04ff,#ff007b); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

    #chatContainer {

      flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 20px;

      width: 100%; max-width: 800px; margin: 0 auto; scroll-behavior: smooth;

    }

    .user-msg-wrapper { align-self: flex-end; position: relative; max-width: 85%; display: flex; flex-direction: column; align-items: flex-end; }

    .user-msg { background-color: var(--user-purple); color: white; padding: 12px 18px; border-radius: 20px 20px 4px 20px; font-size: 15px; cursor: pointer; user-select: none; }

    .edit-btn-popup { position: absolute; top: -35px; background: #000000; color: white; padding: 4px 12px; border-radius: 6px; font-size: 12px; cursor: pointer; z-index: 10; }

    .ai-msg-wrapper { align-self: flex-start; width: 100%; display: flex; flex-direction: column; }

    .ai-content { background: var(--ai-bubble); padding: 16px; border-radius: 18px; line-height: 1.5; font-size: 15px; min-height: 20px; }

    /* Scroll Bottom Button */

    #scrollTopBtn {

      position: fixed; bottom: 100px; right: 20px; width: 40px; height: 40px; background: white;

      border: 1px solid var(--border); border-radius: 50%; display: none; align-items: center;

      justify-content: center; cursor: pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.1); z-index: 100;

    }

    #scrollTopBtn svg { width: 20px; height: 20px; fill: var(--user-purple); }

    /* Jumping Dots */

    .neural-dots { display: flex; gap: 6px; padding: 15px; align-items: center; }

    .dot { width: 8px; height: 8px; background: var(--user-purple); border-radius: 50%; animation: jump 1.2s infinite ease-in-out; }

    .dot:nth-child(2) { animation-delay: 0.2s; }

    .dot:nth-child(3) { animation-delay: 0.4s; }

    @keyframes jump { 0%, 100% { transform: translateY(0); opacity: 0.3; } 30% { transform: translateY(-12px); opacity: 1; } }

    /* Sequential Image Blinks */
    .img-download-btn {
  background: #22c55e; /* green */
  border-radius: 8px;
}

.img-download-btn svg {
  fill: white;
}

.img-download-btn:hover {
  background: #16a34a; /* darker green on hover */
}


    .image-status { font-size: 14px; font-weight: 600; margin-bottom: 8px; display: flex; align-items: center; gap: 4px; }

    .dot-blink { width: 4px; height: 4px; background: currentColor; border-radius: 50%; opacity: 0; animation: seqBlink 1.2s infinite; }

    .dot-blink:nth-child(2) { animation-delay: 0.3s; }

    .dot-blink:nth-child(3) { animation-delay: 0.6s; }

    @keyframes seqBlink { 0%, 100% { opacity: 0; } 50% { opacity: 1; } }

    .tick-icon { width: 18px; height: 18px; background: var(--success-green); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: bold; }

    .image-card { width: 100%; max-width: 400px; aspect-ratio: 1/1; border-radius: 18px; overflow: hidden; position: relative; background: #eee; }

    .gradient-motion { position: absolute; inset: -40%; background: linear-gradient(120deg, #f7d6c9, #f5c7f3, #e9ecff, #fde1cc); background-size: 300% 300%; filter: blur(40px); animation: grad 2s infinite; }

    @keyframes grad { 0%, 100% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } }

    .gen-img { width: 100%; height: 100%; object-fit: cover; display: none; position: relative; z-index: 2; }

    /* Action Row with SVGs Only */

    .action-row { display: flex; gap: 12px; margin-top: 8px; }

    .icon-action-btn { background: transparent; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; padding: 4px; border-radius: 4px; transition: 0.2s; }

    .icon-action-btn:hover { background: #eee; }

    .icon-action-btn svg { width: 18px; height: 18px; fill: #666; }

    .icon-action-btn.is-speaking svg { fill: var(--speaking-red); }

    .bottom-bar { padding: 15px 20px 30px; background: white; border-top: 1px solid var(--border); display: flex; justify-content: center; position: relative; }

    .input-box { width: 100%; max-width: 700px; background: #f1f3f4; border-radius: 28px; display: flex; align-items: center; padding: 5px 12px; }

    #question { flex: 1; border: none; outline: none; background: transparent; padding: 10px; font-size: 16px; resize: none; max-height: 100px; }

    .icon-btn { background: transparent; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; width: 35px; height: 35px; border-radius: 50%; }

    #sendBtn { background: #000; }

    #sendBtn svg { fill: #fff; width: 20px; height: 20px; }

  </style>

</head>

<body>

  <header class="header"><h1 class="logo-text">ùïØùñäùïæùñç ùóîùó∂</h1></header>

  <main id="chatContainer"></main>

  

  <div id="scrollTopBtn"><svg viewBox="0 0 24 24"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"/></svg></div>

  <div class="bottom-bar">

    <div class="input-box">

      <button class="icon-btn"><svg viewBox="0 0 24 24"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/><path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/></svg></button>

      <textarea id="question" placeholder="Ask ùïØùñäùïæùñç ùóîùó∂ ..." rows="1"></textarea>

      <button id="sendBtn" class="icon-btn"><svg viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg></button>

    </div>

  </div>

  <script>

    const chat = document.getElementById('chatContainer');

    const input = document.getElementById('question');

    const sendBtn = document.getElementById('sendBtn');

    const scrollBtn = document.getElementById('scrollTopBtn');

    let currentUtterance = null;

    let pressTimer;

    // Scroll Logic

    chat.onscroll = () => {

      const threshold = chat.scrollHeight - chat.clientHeight - 100;

      scrollBtn.style.display = chat.scrollTop < threshold ? 'flex' : 'none';

    };

    scrollBtn.onclick = () => chat.scrollTo({ top: chat.scrollHeight, behavior: 'smooth' });

    input.addEventListener('input', () => {

      input.style.height = 'auto';

      input.style.height = input.scrollHeight + 'px';

    });

    async function handleRequest() {

      const q = input.value.trim();

      if (!q) return;

      appendMsg('user', q);

      input.value = '';

      input.style.height = 'auto';

      if (q.toLowerCase().match(/\b(generate|draw|create|make|image|photo|picture)\b/)) {

        await handleImage(q);

      } else {

        await handleText(q);

      }

    }

    async function handleImage(q) {

      const id = 'img-' + Date.now();

      const wrapper = document.createElement('div');

      wrapper.className = 'ai-msg-wrapper msg-block';

      wrapper.innerHTML = `

        <div class="image-status" id="stat-${id}">Generating image<div class="dot-blink"></div><div class="dot-blink"></div><div class="dot-blink"></div></div>

        <div class="image-card" id="${id}"><div class="gradient-motion"></div><img class="gen-img" crossOrigin="anonymous"></div>

        <div class="action-row" style="display:none">

          <button class="icon-action-btn img-download-btn" onclick="saveVisual('${id}')">
<svg viewBox="0 0 24 24"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg></button>

        </div>`;

      chat.appendChild(wrapper);

      scrollToBottom();

      const img = wrapper.querySelector('.gen-img');

      img.src = `https://image.pollinations.ai/prompt/${encodeURIComponent(q)}?seed=${Math.floor(Math.random()*99999)}&width=1024&height=1024&nologo=true`;

      img.onload = () => {

        wrapper.querySelector('.gradient-motion').remove();

        img.style.display = 'block';

        document.getElementById(`stat-${id}`).innerHTML = `<div class="tick-icon">‚úì</div> Generating image completed`;

        wrapper.querySelector('.action-row').style.display = 'flex';

        scrollToBottom();

      };

    }

    async function handleText(q) {

      const loader = document.createElement('div');

      loader.className = 'ai-msg-wrapper msg-block';

      loader.innerHTML = `<div class="neural-dots"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>`;

      chat.appendChild(loader);

      scrollToBottom();

      try {

        const res = await fetch("https://desh-ai.onrender.com/ask", {

          method: "POST", headers: { "Content-Type": "application/json" },

          body: JSON.stringify({ question: q })

        });

        const data = await res.json();

        loader.remove();

        await appendAiText(data.answer);

      } catch (e) {

        loader.remove();

        appendMsg('ai', "Neural link offline.");

      }

    }

    function appendMsg(sender, text) {

      const wrapper = document.createElement('div');

      if (sender === 'user') {

        wrapper.className = 'user-msg-wrapper msg-block';

        wrapper.innerHTML = `<div class="user-msg" onmousedown="startPress(event)" onmouseup="endPress()" ontouchstart="startPress(event)" ontouchend="endPress()">${text}</div>`;

      } else {

        wrapper.className = 'ai-msg-wrapper msg-block';

        wrapper.innerHTML = `<div class="ai-content">${text}</div>`;

      }

      chat.appendChild(wrapper);

      scrollToBottom();

    }

    async function appendAiText(fullText) {

      const id = Date.now();

      const txtId = 'txt-' + id;

      const wrapper = document.createElement('div');

      wrapper.className = 'ai-msg-wrapper msg-block';

      wrapper.innerHTML = `<div class="ai-content" id="${txtId}"></div>

        <div class="action-row" style="opacity:0">

          <button class="icon-action-btn" id="spk-${txtId}" onclick="toggleSpeak('${txtId}')"><svg viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg></button>

          <button class="icon-action-btn" onclick="copyText('${txtId}')"><svg viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg></button>

          <button class="icon-action-btn" onclick="downloadPdf('${txtId}')"><svg viewBox="0 0 24 24"><path d="M20 2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-8.5 7.5c0 .83-.67 1.5-1.5 1.5H9v2H7.5V7H10c.83 0 1.5.67 1.5 1.5v1zm5 2c0 .83-.67 1.5-1.5 1.5h-2.5V7H15c.83 0 1.5.67 1.5 1.5v3zm4-3H19v1h1.5V11H19v2h-1.5V7h3v1.5zM9 9.5h1v-1H9v1zM14 11h1v-2.5h-1V11z"/></svg></button>

        </div>`;

      chat.appendChild(wrapper);

      

      const content = wrapper.querySelector('.ai-content');

      const words = fullText.split(' ');

      for(let i=0; i<words.length; i++) {

        content.innerHTML = marked.parse(words.slice(0, i+1).join(' '));

        scrollToBottom();

        await new Promise(r => setTimeout(r, 40));

      }

      wrapper.querySelector('.action-row').style.opacity = '1';

    }

    function scrollToBottom() {

      chat.scrollTop = chat.scrollHeight;

    }

    window.toggleSpeak = (id) => {

      const btn = document.getElementById(`spk-${id}`);

      if (window.speechSynthesis.speaking && currentUtterance?.id === id) {

        window.speechSynthesis.cancel();

        btn.classList.remove('is-speaking');

        currentUtterance = null;

      } else {

        window.speechSynthesis.cancel();

        document.querySelectorAll('.is-speaking').forEach(b => b.classList.remove('is-speaking'));

        

        // Filter text to only keep valid characters (alphabets, dots, @)

        const raw = document.getElementById(id).innerText;

        const cleanText = raw.replace(/[^a-zA-Z0-9\s.@,!?]/g, '');

        

        const msg = new SpeechSynthesisUtterance(cleanText);

        msg.id = id;

        msg.onend = () => btn.classList.remove('is-speaking');

        currentUtterance = msg;

        btn.classList.add('is-speaking');

        window.speechSynthesis.speak(msg);

      }

    };

    window.startPress = (e) => {

      const target = e.currentTarget;

      pressTimer = window.setTimeout(() => {

        document.querySelector('.edit-btn-popup')?.remove();

        const btn = document.createElement('div');

        btn.className = 'edit-btn-popup';

        btn.innerText = 'Edit';

        btn.onclick = () => {

          input.value = target.innerText;

          input.focus();

          let currentBlock = target.closest('.msg-block');

          while (currentBlock.nextSibling) currentBlock.nextSibling.remove();

          currentBlock.remove();

          btn.remove();

        };

        target.parentElement.appendChild(btn);

      }, 800);

    };

    window.endPress = () => clearTimeout(pressTimer);

    window.saveVisual = (id) => html2canvas(document.getElementById(id), {useCORS:true}).then(c => { const a=document.createElement('a'); a.download=`${id}.png`; a.href=c.toDataURL(); a.click(); });

    window.downloadPdf = async (id) => { const {jsPDF}=window.jspdf; const c=await html2canvas(document.getElementById(id)); const pdf=new jsPDF('p','mm','a4'); const w=pdf.internal.pageSize.getWidth(); pdf.addImage(c.toDataURL('image/png'),'PNG',0,0,w,(c.height*w)/c.width); pdf.save(`${id}.pdf`); };

    window.copyText = (id) => navigator.clipboard.writeText(document.getElementById(id).innerText);

    sendBtn.onclick = handleRequest;

    input.onkeydown = (e) => { if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); handleRequest(); }};

  </script>

</body>

</html>

