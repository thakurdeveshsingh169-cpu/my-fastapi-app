<!DOCTYPE html>

<html lang="en">

<head>

  <meta charset="UTF-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>ùïØùñäùïæùñç ùóîùó∂ Pro</title>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>

    :root {

      --bg-white: #ffffff;

      --ai-bubble: #f1f3f4;

      --user-purple: #f5b342;

      --text-main: #1a1a1a;

      --border: #e0e0e0;

      --success-green: #28a745;

      --speaking-red: #ef4444;

    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    body {

      margin: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;

      background-color: var(--bg-white); height: 100vh; display: flex; flex-direction: column; overflow: hidden;

    }
/* Logo system */
.logo-brand {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0;
}

.logo-char-img {
  height: 35px;          /* matches text height */
  width: auto;
  object-fit: contain;
  margin-right: -12px;    /* tight D + esh spacing */
}
body {
  padding-top: 30px; /* üëà pushes header down */
  padding-bottom: 19px;
}

.brand-text-rest {
  font-size: 25px;
  font-weight: 800;
  background: linear-gradient(90deg, #5742f5, #ff04ff);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  font-family: 'Segoe UI', sans-serif;
  line-height: 1;
}

    .header { padding: 12px 20px; border-bottom: 1px solid var(--border); background: #ffffff; text-align: center; border-radius: 15px;box-shadow: 0 0 4px rgb(255, 187, 0);padding: 20px 25px;
      border-radius: 25px;
      margin-top: 20px;
      margin: auto;}

    .logo-text { font-size: 32px; font-weight: 800; margin: 0; background: linear-gradient(90deg, #5742f5, #ff04ff,#ff007b); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

    #chatContainer {

      flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 20px;

      width: 100%; max-width: 800px; margin: 0 auto; scroll-behavior: smooth;

    }

    .user-msg-wrapper { align-self: flex-end; position: relative; max-width: 85%; display: flex; flex-direction: column; align-items: flex-end; }

    .user-msg { background-color: var(--user-purple); color: white; padding: 12px 18px; border-radius: 20px 20px 4px 20px; font-size: 15px; cursor: pointer; user-select: none; }

    .edit-btn-popup { position: absolute; top: -35px; background: #000000; color: white; padding: 4px 12px; border-radius: 6px; font-size: 12px; cursor: pointer; z-index: 10; }

    .ai-msg-wrapper { align-self: flex-start; width: 100%; display: flex; flex-direction: column;}
    .ai-content { background: var(--ai-bubble); padding: 16px; border-radius: 18px; line-height: 1.5; font-size: 15px; min-height: 20px; }

    /* Scroll Bottom Button */

    #scrollTopBtn {

      position: fixed; bottom: 100px; right: 20px; width: 40px; height: 40px; background: white;

      border: 1px solid var(--border); border-radius: 50%; display: none; align-items: center;box-shadow: 0 0 4px rgb(255, 187, 0);

      justify-content: center; cursor: pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.1); z-index: 100;

    }

    #scrollTopBtn svg { width: 20px; height: 20px; fill: var(--user-purple);  }

    /* Jumping Dots */

    .neural-dots { display: flex; gap: 6px; padding: 15px; align-items: center; }

    .dot { width: 8px; height: 8px; background: var(--user-purple); border-radius: 50%; animation: jump 1.2s infinite ease-in-out; }

    .dot:nth-child(2) { animation-delay: 0.2s; }

    .dot:nth-child(3) { animation-delay: 0.4s; }

    @keyframes jump { 0%, 100% { transform: translateY(0); opacity: 0.3; } 30% { transform: translateY(-12px); opacity: 1; } }

    /* Sequential Image Blinks */
    .img-download-btn {
  background: #22c55e; /* green */
  border-radius: 8px;
  box-shadow: 0 0 4px rgb(255, 187, 0);
}

.img-download-btn svg {
  fill: white;
}

.img-download-btn:hover {
  background: #16a34a; /* darker green on hover */
}

/* Mic border glow (no color change, no animation) */

    .image-status { font-size: 14px; font-weight: 600; margin-bottom: 8px; display: flex; align-items: center; gap: 4px; }

    .dot-blink { width: 4px; height: 4px; background: currentColor; border-radius: 50%; opacity: 0; animation: seqBlink 1.2s infinite; }


    .dot-blink:nth-child(2) { animation-delay: 0.3s; }

    .dot-blink:nth-child(3) { animation-delay: 0.6s; }

    @keyframes seqBlink { 0%, 100% { opacity: 0; } 50% { opacity: 1; } }

    .tick-icon { width: 18px; height: 18px; background: var(--success-green); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: bold; }

    .image-card { width: 100%; max-width: 400px; aspect-ratio: 1/1; border-radius: 18px; overflow: hidden; position: relative; background: #eee; }


    .gradient-motion { position: absolute; inset: -40%; background: linear-gradient(120deg, #f7d6c9, #f5c7f3, #e9ecff, #fde1cc); background-size: 300% 300%; filter: blur(40px); animation: grad 2s infinite; }

    @keyframes grad { 0%, 100% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } }

    .gen-img { width: 100%; height: 100%; object-fit: cover; display: none; position: relative; z-index: 2; }

    /* Action Row with SVGs Only */
#question {
  flex: 1;
}
/* mic active state */
.mic-btn.active {
  box-shadow:
    0 0 0 2px rgba(255,145,0,0.9),
    0 0 12px rgba(255,145,0,0.6);
}

.mic-btn.active svg {
  fill: #ff0000;
}

/* soft pulse */
.mic-btn.active {
  animation: micPulse 1.2s infinite ease-in-out;
}

@keyframes micPulse {
  0%   { box-shadow: 0 0 0 2px rgba(255,145,0,0.7); }
  50%  { box-shadow: 0 0 0 6px rgba(255,145,0,0.3); }
  100% { box-shadow: 0 0 0 2px rgba(255,145,0,0.7); }
}

.input-box {
  width: 100%;
  max-width: 700px;
  background: #f1f3f4;
  border-radius: 28px;
  display: flex;
  align-items: center;
  padding: 5px 12px;
  transition: box-shadow 1.5s ease;
}

#question {
  flex: 1;
  border: none;
  outline: none;
  background: transparent;
  padding: 10px;
  font-size: 16px;
  resize: none;
}

.icon-btn {
  background: white;
  border: none;
  cursor: pointer;
  width: 35px;
  height: 35px;
  border-radius: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 0 6px rgb(255, 187, 0)
}

#sendBtn {
  background: #000;
}


#sendBtn svg {
  fill: #000000;
}

    .action-row { display: flex; gap: 12px; margin-top: 8px; }

    .icon-action-btn { background: transparent; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; padding: 4px; border-radius: 4px; transition: 0.2s;box-shadow: 0 0 4px rgb(255, 187, 0) }

    .icon-action-btn:hover { background: #eee; }

    .icon-action-btn svg { width: 18px; height: 18px; fill: #666; }

    .icon-action-btn.is-speaking svg { fill: var(--speaking-red); }

    .bottom-bar { padding: 15px 20px 30px; background: white; border-top: 1px solid var(--border); display: flex; justify-content: center; position: relative; }

    .input-box { width: 100%; max-width: 700px; background: #f1f3f4; border-radius: 28px; display: flex; align-items: center; padding: 5px 12px; }

/* üéôÔ∏è mic glow (strong & permanent) */
.input-box.glow-mic {
  box-shadow:
    0 0 0 2.5px rgba(255,145,0,1),
    0 0 14px rgba(255,145,0,0.9);
}

/* ‚å®Ô∏è typing glow (soft & temporary) */
.input-box.glow-type {
  box-shadow:
    0 0 0 2px rgba(255,145,0,0.7),
    0 0 8px rgba(255,166,0,0.5);
}
@keyframes glowRamp {
  0% {
    box-shadow:
      0 0 0 0.8px rgba(255,145,0,0.4),
      0 0 3px rgba(255,145,0,0.2);
  }
  100% {
    box-shadow:
      0 0 0 2.5px rgba(255,145,0,1),
      0 0 14px rgba(255,145,0,0.9);
  }
}
.input-box.glow-type {
  animation: glowRamp 1.35s ease-out forwards;
}
.input-box.glow-mic {
  animation: glowRamp 1.25s ease-out forwards;
}

/* üî• glow ON state */


.input-box {
  align-items: flex-end;
  transition: padding 0.2s ease;
}
#question {
  max-height: 140px;
  overflow-y: auto;
  transition: height 0.2s ease;
}

    #question { flex: 1; border: none; outline: none; background: transparent; padding: 10px; font-size: 16px; resize: none; max-height: 100px; }

    .icon-btn { background: transparent; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; width: 35px; height: 35px; border-radius: 50%; }

    #sendBtn { background: #ffffff; }

    #sendBtn svg { fill: #000000; width: 20px; height: 20px; }

  </style>

</head>

<body>

  <header class="header">
  <div class="logo-brand">
    <!-- Logo image acts as the "ùïØ" -->
    <img src="static/logo.png" alt="Desh AI Logo" class="logo-char-img">
    <span class="brand-text-rest">ùñäùïæùñç ùóîùó∂</span>
  </div>
</header>


  <main id="chatContainer"></main>

  

  <div id="scrollTopBtn"><svg viewBox="0 0 24 24"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"/></svg></div>


<div class="bottom-bar">
  <div class="input-box" id="inputBox">

    <!-- MIC -->
    <button class="icon-btn mic-btn" id="micBtn">
      <svg viewBox="0 0 24 24">
        <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/>
        <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
      </svg>
    </button>

    <!-- TEXT -->
    <textarea
      id="question"
      placeholder="Ask ùïØùñäùïæùñç..."
      rows="1">
    </textarea>

    <!-- SEND -->
    <button id="sendBtn" class="icon-btn">
      <svg viewBox="0 0 24 24">
        <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
      </svg>
    </button>

  </div>
</div>


  <script>

    const chat = document.getElementById('chatContainer');

    const input = document.getElementById('question');

    const sendBtn = document.getElementById('sendBtn');
const inputBox = document.querySelector('.input-box');
let glowTimer = null;
const micBtn = document.getElementById('micBtn');
const SpeechRecognition =
  window.SpeechRecognition || window.webkitSpeechRecognition;

let recognition = null;

if (SpeechRecognition) {
  recognition = new SpeechRecognition();
  recognition.continuous = true;
  recognition.interimResults = true;
  recognition.lang = 'en-US';
} else {
  console.warn("SpeechRecognition not supported");
}
input.addEventListener('input', () => {
  // ‚õî do NOT touch mic glow
  if (micActive) return;

  inputBox.classList.add('glow-type');

  clearTimeout(glowTimer);

  glowTimer = setTimeout(() => {
    if (!micActive) {
      inputBox.classList.remove('glow-type');
    }
  }, 1500);
});

let micActive = false;

micBtn.addEventListener('click', async () => {
  if (!recognition) {
    alert("Mic not supported in this browser.");
    return;
  }

  micActive = !micActive;

  micBtn.classList.toggle('active', micActive);

  // üéôÔ∏è mic glow control
  inputBox.classList.toggle('glow-mic', micActive);

  if (micActive) {
    try {
      await navigator.mediaDevices.getUserMedia({ audio: true });
      recognition.start();
    } catch (err) {
      micActive = false;
      micBtn.classList.remove('active');
      inputBox.classList.remove('glow-mic');
    }
  } else {
    recognition.stop();
  }
});

recognition.continuous = false;
recognition.interimResults = true;

recognition.onend = () => {
  micActive = false;
  micBtn.classList.remove('active');
  inputBox.classList.remove('glow-mic');
};


recognition.onresult = (event) => {
  let transcript = '';

  for (let i = event.resultIndex; i < event.results.length; i++) {
    transcript += event.results[i][0].transcript;
  }

  input.value = transcript;
  input.dispatchEvent(new Event('input')); // keeps auto-grow working
};



    const scrollBtn = document.getElementById('scrollTopBtn');

    let currentUtterance = null;

    let pressTimer;

    // Scroll Logic

    chat.onscroll = () => {

      const threshold = chat.scrollHeight - chat.clientHeight - 100;

      scrollBtn.style.display = chat.scrollTop < threshold ? 'flex' : 'none';

    };

    scrollBtn.onclick = () => chat.scrollTo({ top: chat.scrollHeight, behavior: 'smooth' });
micBtn.addEventListener('click', () => {
  console.log("Mic active:", micActive);
});

    input.addEventListener('keydown', () => {
  // If mic is ON, do NOT interfere
  if (micActive) return;

  inputBox.classList.remove('glow');

  clearTimeout(glowTimer);

  glowTimer = setTimeout(() => {
    // remove glow ONLY if mic still OFF
    if (!micActive) {
      inputBox.classList.remove('glow');
    }
  }, 2000);
});

    async function handleRequest() {

      const q = input.value.trim();

      if (!q) return;

      appendMsg('user', q);

      input.value = '';

      input.style.height = 'auto';

      if (q.toLowerCase().match(/\b(generate|draw|create|make|image|photo|picture)\b/)) {

        await handleImage(q);

      } else {

        await handleText(q);

      }

    }

    async function handleImage(q) {

      const id = 'img-' + Date.now();

      const wrapper = document.createElement('div');

      wrapper.className = 'ai-msg-wrapper msg-block';

      wrapper.innerHTML = `

        <div class="image-status" id="stat-${id}">Generating image<div class="dot-blink"></div><div class="dot-blink"></div><div class="dot-blink"></div></div>

        <div class="image-card" id="${id}"><div class="gradient-motion"></div><img class="gen-img" crossOrigin="anonymous"></div>

        <div class="action-row" style="display:none">

          <button class="icon-action-btn img-download-btn" onclick="saveVisual('${id}')">
<svg viewBox="0 0 24 24"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg></button>

        </div>`;

      chat.appendChild(wrapper);

      scrollToBottom();

      const img = wrapper.querySelector('.gen-img');

      img.src = `https://image.pollinations.ai/prompt/${encodeURIComponent(q)}?seed=${Math.floor(Math.random()*99999)}&width=1024&height=1024&nologo=true`;

      img.onload = () => {

        wrapper.querySelector('.gradient-motion').remove();

        img.style.display = 'block';

        document.getElementById(`stat-${id}`).innerHTML = `<div class="tick-icon">‚úì</div> Generating image completed`;

        wrapper.querySelector('.action-row').style.display = 'flex';

        scrollToBottom();

      };

    }
function autoGrowTextarea(el) {
  el.style.height = "auto";
  el.style.height = el.scrollHeight + "px";
}

input.addEventListener("input", () => {
  autoGrowTextarea(input);
});

    async function handleText(q) {

      const loader = document.createElement('div');

      loader.className = 'ai-msg-wrapper msg-block';

      loader.innerHTML = `<div class="neural-dots"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>`;

      chat.appendChild(loader);

      scrollToBottom();

      try {

        const res = await fetch("https://desh-ai.onrender.com/ask", {

          method: "POST", headers: { "Content-Type": "application/json" },

          body: JSON.stringify({ question: q })

        });

        const data = await res.json();

        loader.remove();

        await appendAiText(data.answer);

      } catch (e) {

        loader.remove();

        appendMsg('ai', "Desh Ai Currently offline, Try after a while.");

      }

    }

    function appendMsg(sender, text) {

      const wrapper = document.createElement('div');

      if (sender === 'user') {

        wrapper.className = 'user-msg-wrapper msg-block';

        wrapper.innerHTML = `<div class="user-msg" onmousedown="startPress(event)" onmouseup="endPress()" ontouchstart="startPress(event)" ontouchend="endPress()">${text}</div>`;

      } else {

        wrapper.className = 'ai-msg-wrapper msg-block';

        wrapper.innerHTML = `<div class="ai-content">${text}</div>`;

      }

      chat.appendChild(wrapper);

      scrollToBottom();

    }

    async function appendAiText(fullText) {

      const id = Date.now();

      const txtId = 'txt-' + id;

      const wrapper = document.createElement('div');

      wrapper.className = 'ai-msg-wrapper msg-block';

      wrapper.innerHTML = `<div class="ai-content" id="${txtId}"></div>

        <div class="action-row" style="opacity:0">

          <button class="icon-action-btn" id="spk-${txtId}" onclick="toggleSpeak('${txtId}')"><svg viewBox="0 0 24 24"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg></button>

          <button class="icon-action-btn" onclick="copyText('${txtId}')"><svg viewBox="0 0 24 24"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg></button>

          <button class="icon-action-btn" onclick="downloadPdf('${txtId}')"><svg viewBox="0 0 24 24"><path d="M20 2H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-8.5 7.5c0 .83-.67 1.5-1.5 1.5H9v2H7.5V7H10c.83 0 1.5.67 1.5 1.5v1zm5 2c0 .83-.67 1.5-1.5 1.5h-2.5V7H15c.83 0 1.5.67 1.5 1.5v3zm4-3H19v1h1.5V11H19v2h-1.5V7h3v1.5zM9 9.5h1v-1H9v1zM14 11h1v-2.5h-1V11z"/></svg></button>

        </div>`;

      chat.appendChild(wrapper);

      

      const content = wrapper.querySelector('.ai-content');

      const words = fullText.split(' ');

      for(let i=0; i<words.length; i++) {

        content.innerHTML = marked.parse(words.slice(0, i+1).join(' '));

        scrollToBottom();

        await new Promise(r => setTimeout(r, 40));

      }

      wrapper.querySelector('.action-row').style.opacity = '1';

    }

    function scrollToBottom() {

      chat.scrollTop = chat.scrollHeight;

    }

    window.toggleSpeak = (id) => {

      const btn = document.getElementById(`spk-${id}`);

      if (window.speechSynthesis.speaking && currentUtterance?.id === id) {

        window.speechSynthesis.cancel();

        btn.classList.remove('is-speaking');

        currentUtterance = null;

      } else {

        window.speechSynthesis.cancel();

        document.querySelectorAll('.is-speaking').forEach(b => b.classList.remove('is-speaking'));

        

        // Filter text to only keep valid characters (alphabets, dots, @)

        const raw = document.getElementById(id).innerText;

        const cleanText = raw.replace(/[^a-zA-Z0-9\s.@,!?]/g, '');

        

        const msg = new SpeechSynthesisUtterance(cleanText);

        msg.id = id;

        msg.onend = () => btn.classList.remove('is-speaking');

        currentUtterance = msg;

        btn.classList.add('is-speaking');

        window.speechSynthesis.speak(msg);

      }

    };

    window.startPress = (e) => {

      const target = e.currentTarget;

      pressTimer = window.setTimeout(() => {

        document.querySelector('.edit-btn-popup')?.remove();

        const btn = document.createElement('div');

        btn.className = 'edit-btn-popup';

        btn.innerText = 'Edit';

        btn.onclick = () => {

          input.value = target.innerText;

          input.focus();

          let currentBlock = target.closest('.msg-block');

          while (currentBlock.nextSibling) currentBlock.nextSibling.remove();

          currentBlock.remove();

          btn.remove();

        };

        target.parentElement.appendChild(btn);

      }, 800);

    };

    window.endPress = () => clearTimeout(pressTimer);

    window.saveVisual = (id) => html2canvas(document.getElementById(id), {useCORS:true}).then(c => { const a=document.createElement('a'); a.download=`${id}.png`; a.href=c.toDataURL(); a.click(); });

    window.downloadPdf = async (id) => { const {jsPDF}=window.jspdf; const c=await html2canvas(document.getElementById(id)); const pdf=new jsPDF('p','mm','a4'); const w=pdf.internal.pageSize.getWidth(); pdf.addImage(c.toDataURL('image/png'),'PNG',0,0,w,(c.height*w)/c.width); pdf.save(`${id}.pdf`); };

    window.copyText = (id) => navigator.clipboard.writeText(document.getElementById(id).innerText);

    sendBtn.onclick = handleRequest;

    input.onkeydown = (e) => { if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); handleRequest(); }};

  </script>

</body>

</html>






